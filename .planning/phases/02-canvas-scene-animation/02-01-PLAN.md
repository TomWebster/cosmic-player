---
phase: 02-canvas-scene-animation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/scripts/sceneData.js
  - src/scripts/canvasRenderer.js
autonomous: true

must_haves:
  truths:
    - "Black space backdrop fills entire viewport with no visible seams"
    - "Sparse bright starfield is visible across the background"
    - "A large Saturn-colored planet with 3D gradient sphere effect is visible"
    - "Two subtle khaki moons are visible in the foreground area"
    - "A distant sun with radial glow is visible"
    - "All scene elements are positioned correctly relative to the viewport"
  artifacts:
    - path: "src/scripts/sceneData.js"
      provides: "Scene layer definitions — stars, planet, moons, sun"
      exports: ["createScene"]
    - path: "src/scripts/canvasRenderer.js"
      provides: "Full scene rendering with all cosmic elements"
      contains: "renderScene"
  key_links:
    - from: "src/scripts/canvasRenderer.js"
      to: "src/scripts/sceneData.js"
      via: "import createScene"
      pattern: "import.*createScene.*from.*sceneData"
    - from: "src/scripts/canvasRenderer.js"
      to: "Canvas 2D context"
      via: "radialGradient for planet/sun, arc for stars/moons"
      pattern: "createRadialGradient"
---

<objective>
Render the complete static cosmic space scene — starfield, Saturn-colored planet, two khaki moons, and distant sun — on the existing DPI-aware canvas.

Purpose: Establishes all visual elements and their rendering logic before adding motion. Getting the static scene right first ensures visual correctness can be verified independently of animation timing.

Output: A single rendered frame showing the full cosmic composition on page load.
</objective>

<execution_context>
@/Users/tomw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-canvas-scene-animation/02-RESEARCH.md
@src/scripts/canvasRenderer.js
@src/scripts/main.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scene data model with layer definitions</name>
  <files>src/scripts/sceneData.js</files>
  <action>
Create a new module `src/scripts/sceneData.js` that exports a `createScene(width, height)` function. This function accepts the logical viewport dimensions (CSS pixels, not canvas buffer pixels) and returns a scene object containing all layer data.

The scene object structure:

```javascript
{
  stars: [ { x, y, radius, brightness } ... ],
  sun: { x, y, radius, colors },
  planet: { x, y, radius, colors },
  moons: [ { x, y, radius, color }, { x, y, radius, color } ],
  layers: {
    stars:   { depth: 0.2 },   // Slowest — furthest away
    sun:     { depth: 0.3 },
    planet:  { depth: 0.5 },   // Midground
    moons:   { depth: 0.8 }    // Fastest — foreground
  }
}
```

Star generation:
- Generate ~80-120 stars (start with 100) using a distribution that feels sparse but rich — NOT uniform random. Use a mild bias that avoids clustering stars in corners. Stars should feel scattered across the entire viewport. Each star gets a radius between 0.5 and 2.0 and a brightness value between 0.5 and 1.0 (for later use as alpha).
- Stars should be generated across a wider area than the viewport (e.g., 1.5x width) to allow for parallax drift without gaps appearing at edges.

Planet positioning:
- Saturn-colored planet. Large — radius approximately 12-15% of the smaller viewport dimension (e.g., ~80-100px on a 1920x1080 screen). Position offset slightly right and below center for visual asymmetry (e.g., x: width * 0.6, y: height * 0.55). Colors array for radial gradient: highlight '#e6d5a8', midtone '#c4a24d', shadow '#5a4a30'.

Moon positioning:
- Two khaki moons. Subtle and understated — radius approximately 15-20% of the planet radius. Positioned near but not overlapping the planet. Color: '#8a7a5e'. Give each moon slightly different size for naturalism.

Sun positioning:
- Distant sun as a light source. Small but with a glow — radius ~3-5% of viewport width. Position in upper-left area (e.g., x: width * 0.15, y: height * 0.2) to create a sense of distant illumination. Colors for radial gradient: core '#fffacd', mid '#ffd700', outer 'rgba(255, 215, 0, 0)' (fades to transparent for glow effect).

The `layers` object stores parallax depth multipliers only — these will be used by the animation system in Plan 02. Include them now so the data model is complete.

Do NOT use biasedRand formula from research verbatim — it concentrates stars too heavily at center. Instead use a simpler approach: uniform random across the extended canvas area, which produces the sparse scattered feel matching the 80s Elite aesthetic.
  </action>
  <verify>
Open the file and confirm: (1) `createScene` is exported as a named export, (2) it returns an object with stars array (~100 items), sun object, planet object, moons array (2 items), and layers object with depth values, (3) all positions are relative to the passed width/height, (4) star generation area extends beyond viewport bounds.
  </verify>
  <done>sceneData.js exports createScene(width, height) returning complete scene data with all cosmic elements and parallax depth definitions.</done>
</task>

<task type="auto">
  <name>Task 2: Extend canvas renderer with full scene rendering</name>
  <files>src/scripts/canvasRenderer.js</files>
  <action>
Extend the existing `canvasRenderer.js` to render the complete cosmic scene. The current file has: `initCanvas()`, `setupCanvas()`, `animate()`, and `stopAnimation()`. Preserve all exports and the existing DPI-aware setup.

Changes needed:

1. **Import sceneData:** Add `import { createScene } from './sceneData.js';` at the top.

2. **Add scene state:** Add a module-level `let scene = null;` variable.

3. **Initialize scene in initCanvas():** After `setupCanvas()`, call `scene = createScene(window.innerWidth, window.innerHeight);`. This uses CSS pixel dimensions (logical), not canvas buffer dimensions.

4. **Regenerate scene on resize:** In `setupCanvas()`, after the existing DPI scaling code, regenerate the scene: `scene = createScene(window.innerWidth, window.innerHeight);`. This ensures element positions adapt to new viewport dimensions. (Note: this is acceptable for Phase 2; Phase 3 may preserve positions across resizes if needed.)

5. **Add renderScene(ctx) function:** This is the core rendering function. It draws all layers back-to-front in this order:

   a. **Black background** (already exists in animate — move here):
      ```
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
      ```

   b. **Stars (background layer):**
      Set `ctx.fillStyle = '#ffffff'` once. Loop through `scene.stars`, for each star: set `ctx.globalAlpha = star.brightness`, call `ctx.beginPath()`, `ctx.arc(Math.floor(star.x), Math.floor(star.y), star.radius, 0, Math.PI * 2)`, `ctx.fill()`. Reset `ctx.globalAlpha = 1.0` after the loop.

   c. **Sun (distant light source):**
      Create a radial gradient from sun center with inner radius 0 to outer radius `sun.radius`. Add color stops from sun.colors array (core at 0, mid at 0.4, outer/transparent at 1.0). Set `ctx.fillStyle` to gradient, `ctx.beginPath()`, `ctx.arc(...)`, `ctx.fill()`.

   d. **Planet (midground):**
      Create a radial gradient with offset highlight circle for 3D sphere effect (offset inner circle by -radius*0.3 in x and y, inner radius = radius*0.2). Add three color stops from planet.colors (highlight at 0, midtone at 0.5, shadow at 1.0). Fill the circle.

   e. **Moons (foreground):**
      For each moon: set `ctx.fillStyle = moon.color`, `ctx.beginPath()`, `ctx.arc(Math.floor(moon.x), Math.floor(moon.y), moon.radius, 0, Math.PI * 2)`, `ctx.fill()`. Add a subtle radial gradient to moons too — highlight at top-left offset, same color but lighter at center, darker at edge. Use a simpler 2-stop gradient: lighter khaki '#a09070' at 0, moon.color at 1.0.

6. **Update animate():** Replace the current black-fill body with a single call to `renderScene(ctx)`. Keep the `requestAnimationFrame(animate)` call. Remove the old `clearRect` and `fillRect` calls (renderScene handles the black fill now).

   The animate function does NOT need delta-time yet — that comes in Plan 02. For now it just renders the static scene each frame (which is fine; the scene data doesn't change yet).

Performance notes from research:
- Use `Math.floor()` on all x,y coordinates passed to arc() to avoid sub-pixel anti-aliasing overhead.
- Always call `beginPath()` before each new shape.
- Batch stars with same fillStyle — set it once, not per star.
- Do NOT use `clearRect` before `fillRect('#000')` — the fillRect alone is sufficient and faster.
  </action>
  <verify>
Open the app in a browser. The canvas should display: (1) black background filling entire viewport, (2) scattered white/bright dots (stars) across the scene, (3) a Saturn-colored sphere with 3D gradient shading offset right/below center, (4) two small khaki circles near the planet, (5) a glowing yellow-ish circle in the upper-left area. All elements should be visible and correctly positioned. Resizing the browser window should re-render the scene at the new dimensions.
  </verify>
  <done>canvasRenderer.js renders the complete static cosmic scene — stars, sun, planet, and moons — on every frame using the scene data model. All elements are visible and correctly positioned.</done>
</task>

</tasks>

<verification>
- Open `index.html` in a browser — full cosmic scene visible
- Stars appear scattered (not clustered) across the viewport
- Planet has visible 3D gradient effect (not flat circle)
- Two moons visible near the planet, smaller and subtler
- Sun visible with glow effect in upper-left area
- No JavaScript errors in console
- Resize browser window — scene regenerates correctly at new dimensions
</verification>

<success_criteria>
All five cosmic elements (starfield, planet, two moons, sun) render correctly on the DPI-aware canvas with proper visual styling (gradients, brightness, positioning). The scene fills the entire viewport with no seams or gaps.
</success_criteria>

<output>
After completion, create `.planning/phases/02-canvas-scene-animation/02-01-SUMMARY.md`
</output>
