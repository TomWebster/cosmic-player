---
phase: 01-foundation-audio-playback
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/index.html
  - src/styles/main.css
  - src/data/playlist.json
  - src/scripts/canvasRenderer.js
autonomous: true

must_haves:
  truths:
    - "Project has a serveable index.html that loads all scripts and styles"
    - "Visitor sees a fullscreen black canvas behind a centered splash overlay"
    - "Canvas renders at correct resolution on high-DPI displays"
    - "Canvas resizes properly when browser window resizes"
    - "Playlist JSON contains track metadata with file paths"
  artifacts:
    - path: "src/index.html"
      provides: "Entry point with splash overlay, canvas, audio element, and control elements"
      contains: "audio"
    - path: "src/styles/main.css"
      provides: "Splash screen styling, fullscreen canvas, control layout"
      min_lines: 40
    - path: "src/data/playlist.json"
      provides: "Track metadata array with title, artist, album, filePath"
      contains: "tracks"
    - path: "src/scripts/canvasRenderer.js"
      provides: "Canvas initialization, DPI scaling, resize handler, animation loop"
      exports: ["initCanvas"]
  key_links:
    - from: "src/index.html"
      to: "src/scripts/canvasRenderer.js"
      via: "script tag"
      pattern: "canvasRenderer\\.js"
    - from: "src/index.html"
      to: "src/styles/main.css"
      via: "link tag"
      pattern: "main\\.css"
---

<objective>
Scaffold the Cosmic Player project structure and create the foundational files that all subsequent plans build upon: the HTML entry point with splash screen overlay, audio element, and playback controls; CSS for fullscreen immersive layout; a sample playlist JSON; and a minimal canvas renderer that fills the viewport with black and handles high-DPI displays.

Purpose: Establish the file structure and visual foundation so Plan 02 can focus purely on audio logic and integration wiring without needing to create HTML elements or worry about layout.

Output: A serveable static site with a visible splash screen overlay on a black fullscreen canvas, ready for audio engine integration.
</objective>

<execution_context>
@/Users/tomw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-audio-playback/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold project structure with HTML, CSS, and playlist data</name>
  <files>src/index.html, src/styles/main.css, src/data/playlist.json</files>
  <action>
Create the directory structure: src/, src/styles/, src/scripts/, src/data/.

**src/index.html:**
Create a minimal HTML5 document that includes:
- A `<canvas id="canvas">` element positioned as fullscreen background (behind everything)
- A `<div id="splash">` overlay centered on screen containing a clickable element (e.g., `<button id="enter-button">`) with text like "Enter" or "Click to Enter". The splash must cover the full viewport and sit above the canvas.
- A hidden `<audio id="audio-player">` element (no native controls -- per decision: no play/pause, continuous experience)
- A `<div id="controls">` container (initially hidden via CSS class) containing:
  - `<button id="prev-btn">` for previous track
  - `<button id="next-btn">` for next track
  - `<input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">` for volume
  - `<button id="mute-btn">` for mute toggle
- Script tags loading (in order): canvasRenderer.js, audioPlayer.js, splashScreen.js, main.js -- all as type="module" OR with defer. Use ES modules (type="module") for clean imports/exports.
- Link to styles/main.css

**src/styles/main.css:**
- Reset: margin 0, padding 0, box-sizing border-box, overflow hidden on html/body (fullscreen immersive -- no scrollbars)
- html/body: width/height 100%, background black
- Canvas: position fixed, top 0, left 0, width/height 100%, z-index 0
- Splash overlay (#splash): position fixed, top 0, left 0, width/height 100%, z-index 10, display flex, align-items center, justify-content center, background rgba(0,0,0,0.9) or solid black. Style the enter button with minimal clean aesthetic -- white text on transparent/subtle border, large enough to be obvious. Font: system-ui or a clean sans-serif.
- Controls (#controls): position fixed, bottom of screen, z-index 5, horizontal flex layout, centered. Initially has a `.hidden` class (display: none). Style controls with white/light colors against the dark background, subtle and unobtrusive (the experience is about the music and visuals, not the UI chrome).
- `.hidden` utility class: display none
- Ensure all interactive elements have focus-visible outlines for keyboard accessibility per project constraint.

**src/data/playlist.json:**
Create a sample playlist JSON with this structure:
```json
{
  "tracks": [
    {
      "title": "Track Title",
      "artist": "Artist Name",
      "album": "Album Name",
      "duration": 240,
      "filePath": "/audio/sample-track-01.mp3"
    }
  ]
}
```
Include 3-4 sample entries with placeholder data. The filePaths should point to /audio/ directory (actual audio files will come from the user's Apple Music Library via appleMusicTools -- these are placeholders for development).

Note: No play/pause button -- per locked decision, music plays continuously after entry.
  </action>
  <verify>
Open src/index.html in a browser (or use `python3 -m http.server 8000` from the src/ directory). Verify:
1. Page loads without console errors
2. Splash overlay is visible and centered
3. Background is black
4. Controls are hidden (not visible on initial load)
5. Validate playlist.json is valid JSON: `python3 -c "import json; json.load(open('src/data/playlist.json'))"`
  </verify>
  <done>
index.html loads cleanly with splash overlay visible, canvas element present in DOM, audio element present in DOM, controls present but hidden, and playlist.json contains valid track metadata array.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DPI-aware canvas renderer with animation loop</name>
  <files>src/scripts/canvasRenderer.js</files>
  <action>
Create src/scripts/canvasRenderer.js as an ES module that exports an `initCanvas` function.

**initCanvas():**
- Gets the canvas element by ID ('canvas')
- Gets the 2D rendering context
- Calls setupCanvas() to size it correctly
- Starts the animation loop
- Adds a resize event listener that calls setupCanvas()
- Returns an object with { canvas, ctx } for other modules to access if needed

**setupCanvas():**
- Gets window.devicePixelRatio (default to 1)
- Sets canvas.width = window.innerWidth * dpr
- Sets canvas.height = window.innerHeight * dpr
- Scales the context by dpr: ctx.scale(dpr, dpr)
- Sets canvas CSS width/height to window.innerWidth/innerHeight pixels
- IMPORTANT: Must reset ctx.scale on each resize call. Since scale is cumulative, either save/restore the transform or use ctx.setTransform(dpr, 0, 0, dpr, 0, 0) to set absolute scale.

**animate():**
- Clears the entire canvas (ctx.clearRect)
- Fills with solid black (ctx.fillStyle = '#000', ctx.fillRect over the CSS-sized dimensions, NOT the scaled dimensions)
- Calls requestAnimationFrame(animate) for the next frame
- This is intentionally minimal for Phase 1 -- Phase 2 will add the full space scene

**Why black fill instead of just CSS background:** The canvas will be the rendering surface for the space scene in Phase 2. Establishing the animation loop now ensures the canvas is ready to receive visual content. The black fill is the "infinite blackness" of space described in the project vision.

Export: `export { initCanvas }`
  </action>
  <verify>
After integrating with index.html (script tag already present from Task 1), open in browser and verify:
1. Canvas fills the entire viewport with black
2. No blurriness on Retina/high-DPI displays (text rendered on canvas would be crisp -- can verify by temporarily drawing text)
3. Resize the browser window -- canvas resizes smoothly without distortion
4. Check requestAnimationFrame is running: in browser devtools, Performance tab should show animation frames
5. No console errors
  </verify>
  <done>
Canvas renders a crisp black fullscreen background at correct DPI, resizes with the window, and runs a continuous animation loop via requestAnimationFrame. The module exports initCanvas for use by main.js.
  </done>
</task>

</tasks>

<verification>
1. `python3 -m http.server 8000` from src/ directory serves the site
2. Browser shows splash overlay on black canvas background
3. DevTools Elements panel confirms: canvas, splash, audio, controls elements all present
4. DevTools Console shows no errors
5. playlist.json loads successfully: `fetch('/data/playlist.json').then(r => r.json()).then(console.log)` in console
6. Canvas is correctly sized (canvas.width matches window.innerWidth * devicePixelRatio)
</verification>

<success_criteria>
- All 4 files exist and contain functional code
- index.html loads in browser without errors
- Splash overlay is visible and centered over black canvas
- Canvas animation loop is running (requestAnimationFrame active)
- Canvas handles high-DPI correctly
- Controls exist in DOM but are hidden
- playlist.json is valid and contains track array with title/artist/album/duration/filePath fields
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-audio-playback/01-01-SUMMARY.md`
</output>
